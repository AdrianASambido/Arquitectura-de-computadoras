; HANDSHAKE POR INTERRUPCION
EOI  EQU 20H
IMR  EQU 21H
INT2 EQU 26H

DATO   EQU 40H
ESTADO EQU 41H

ORG 1000H

BOOLEAN DB 0
STRING DB "V4M0S B0C4"
FINAL DB ?

ORG 4000H
SELECCIONADO: CMP DL, 30H
	JS NO_ES
	CMP DL, 39H
	JNS NO_ES
	ES: MOV BOOLEAN, 1
	NO_ES: RET
	
ORG 4500H
POLL: IN AL, ESTADO
      AND AL, 00000001B
			JNZ POLL
		RET

ORG 3000H
SUB_HAND: CMP BX, OFFSET FINAL 
					JZ CHAU
					MOV DL, [BX]
					CALL SELECCIONADO
					CMP BOOLEAN, 1
					JZ IMPRIMIR
					INC BX
					JMP SUB_HAND
					
					IMPRIMIR: MOV BOOLEAN, 0
					CALL POLL
					MOV AL, DL
					OUT DATO, AL
					INC BX
					JMP SUB_HAND
					
					CHAU: IN AL, ESTADO
					AND AL, 01111111B
					OUT ESTADO, AL
					
					FIN: MOV AL, EOI
					OUT EOI, AL
					IRET

ORG 2000H
; GUARDAMOS LA SUBRUTINA EN EL VECTOR DE INTERRUCIONES
 MOV AX, SUB_HAND
	MOV BX, 40
	MOV [BX], AX
	
	CLI
		MOV AL, 11111011B
		OUT IMR, AL
		
		MOV AL, 10
		OUT INT2, AL
		
		MOV BX, OFFSET STRING
		
		IN AL, ESTADO
		OR AL, 10000000B
		OUT ESTADO, AL
	STI

	LOOP:JMP LOOP
	
INT 0 
END